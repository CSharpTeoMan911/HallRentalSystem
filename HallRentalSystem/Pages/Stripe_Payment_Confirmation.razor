@using HallRentalSystem.Classes.StructuralAndBehavioralElements;
@using Microsoft.AspNetCore.WebUtilities;
@using Microsoft.Extensions.Primitives;
@using System.Text;
@inject NavigationManager NavigationManager;
@inject IJSRuntime JS;
@page "/stripe-payment-confirmation";



@code {
    protected override async void OnAfterRender(bool firstRender)
    {
        try
        {
            IJSObjectReference module = await JS.InvokeAsync<IJSObjectReference>("import", "./Scripts/Actions.js");
            string database_key_value = await module.InvokeAsync<string>("StripeCache", null, "Get");

            StringBuilder url_builder = new StringBuilder("/stripe/get");
            url_builder.Append("?data=");
            url_builder.Append(database_key_value);

            HttpClient client = Shared_Data.GenerateHttpCLient();
            client.BaseAddress = new Uri(NavigationManager.BaseUri);

            HttpResponseMessage response = await client.GetAsync(url_builder.ToString());
            string response_message = await response.Content.ReadAsStringAsync();

            await module.InvokeAsync<string>("StripeCache", null, "Delete");

            if (response_message == "Payment confirmation successful")
            {

            }
            else
            {

            }
        }
        catch (Exception E)
        {
            Console.WriteLine("Error: " + E.Message);
        }
    }
}
